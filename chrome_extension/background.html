<!--
This is the background page which is
	(1) to embed the plugin window and
	(2) listen for a message send from the context scripts. 
-->
<!DOCTYPE XHTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>NPAPI Drive-by Download start Firefox test</title>

	<script type="text/javascript" src="./create_plugin.js"></script>

</head>
<body>
	<script type="text/javascript">
chrome.extension.onConnect.addListener(function(port) {
  console.assert(port.name == "recursiveSearch");
  port.onMessage.addListener(function(msg) {    
    // I got the checkedLink at here, what I need to do is use it to traverse DOM
    var totalLinksElement = document.getElementByTagName('a');
    //var totalLinksNums = totalLinks.length;
    for(var i = 0; i < totalLinksElement.length; ++i){
			if(msg.checkedHref.test(totalLinksElement[i])){
				var appDescription = totalLinksElelment[i].innerHTML;
				port.postMessage({Description: appDescription});
				}else 
				console.log('Did not find the app description for the ext-link');
			}
  });
});
	</script>
	<script type="text/javascript" src="./background.js"></script>
</body>
</html>
